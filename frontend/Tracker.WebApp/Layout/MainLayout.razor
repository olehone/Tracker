@inherits LayoutComponentBase

@using Microsoft.AspNetCore.Components.Authorization
@using System.Security.Claims
@using Tracker.Services.Abstraction
@using Tracker.WebApp.States

<MudThemeProvider @bind-IsDarkMode=@_isDarkMode/>

<MudLayout>
    <MudAppBar Elevation="1">
        <MudIconButton Icon=@Icons.Material.Filled.Menu
                       Color="Color.Inherit"
                       Edge="Edge.Start"
                       OnClick=@DrawerToggle/>
        <MudText Typo=Typo.h6>Tracker</MudText>
        <MudSpacer/>
        <AuthorizeView>
            <Authorized>
                @if (AppState?.CurrentUser is not null)
                {
                    <MudText class="mr-4">
                        Welcome, @AppState.CurrentUser.Username
                    </MudText>
                }
                <MudButton Variant="Variant.Text"
                           Color="Color.Inherit"
                           OnClick="@Logout">
                    Logout
                </MudButton>
            </Authorized>
            <NotAuthorized>
                <MudButton Variant="Variant.Text"
                           Color="Color.Inherit"
                           OnClick="@GoToLogin">
                    Login
                </MudButton>
                <MudButton Variant="Variant.Text"
                           Color="Color.Inherit"
                           OnClick="@GoToRegister">
                    Register
                </MudButton>
            </NotAuthorized>
        </AuthorizeView>

        <MudToggleIconButton @bind-Toggled="_isDarkMode"
                             Icon=@Icons.Material.Outlined.WbSunny
                             ToggledIcon=@Icons.Material.Outlined.DarkMode
                             Color="Color.Inherit"/>
    </MudAppBar>
    <MudDrawer @bind-Open="_isDrawerOpen"
               ClipMode="DrawerClipMode.Always"
               Elevation="2">
        <NavMenu/>
    </MudDrawer>
    <MudMainContent Style="height: calc(100vh - var(--mud-appbar-height));">
        @Body
    </MudMainContent>
</MudLayout>