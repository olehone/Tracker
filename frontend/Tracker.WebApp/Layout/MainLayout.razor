@inherits LayoutComponentBase

@inject NavigationManager Nav
@inject AuthenticationStateProvider AuthStateProvider

@using Microsoft.AspNetCore.Components.Authorization

<MudPopoverProvider />
<MudThemeProvider @bind-IsDarkMode=@_isDarkMode />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
	<MudAppBar Elevation="1">
		<MudIconButton Icon="@Icons.Material.Filled.Menu"
					   Color="Color.Inherit"
					   Edge="Edge.Start"
					   OnClick="@DrawerToggle" />

		<MudText Typo="Typo.h6">Tracker</MudText>

		<MudSpacer />

		<AuthorizeView>
			<Authorized Context="auth">
				<MudText Class="mr-4">
					Welcome, @auth.User.Identity?.Name
				</MudText>
			</Authorized>

			<NotAuthorized>
				<MudButton Variant="Variant.Text"
						   Color="Color.Inherit"
						   OnClick="@GoToLogin">
					Login
				</MudButton>
			</NotAuthorized>
		</AuthorizeView>

		<MudToggleIconButton @bind-Toggled="_isDarkMode"
							 Icon="@Icons.Material.Outlined.WbSunny"
							 ToggledIcon="@Icons.Material.Outlined.DarkMode"
							 Color="Color.Inherit" />
	</MudAppBar>
	<MudDrawer @bind-Open="_isDrawerOpen" ClipMode="DrawerClipMode.Always" Elevation="2">
		<NavMenu />
	</MudDrawer>
	<MudMainContent>
		@Body
	</MudMainContent>
</MudLayout>

@code
{
	bool _isDarkMode = false;
	bool _isDrawerOpen = true;

	void DrawerToggle()
	{
		_isDrawerOpen = !_isDrawerOpen;
	}

	private void GoToLogin()
		=> Nav.NavigateTo("/login");
}
